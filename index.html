<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title"></title> <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="config.js"></script>
    <style>
        /* Custom font for a clean look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Darker gray background (gray-900) */
            color: #e2e8f0; /* Light text for contrast */
        }
        /* Style for project cards on hover */
        .project-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            border-radius: 0.75rem; /* Rounded corners */
        }
        .project-card:hover {
            transform: translateY(-5px); /* Lift effect on hover */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3); /* More prominent shadow for dark theme */
        }
        /* Button styling */
        .btn-primary {
            background-color: #4a5568; /* Gray 700 */
            color: white;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease-in-out;
        }
        .btn-primary:hover {
            background-color: #2d3748; /* Gray 800 */
        }
        .btn-secondary {
            background-color: #2d3748; /* Gray 800 */
            color: white;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease-in-out;
        }
        .btn-secondary:hover {
            background-color: #4a5568; /* Gray 700 */
        }
        /* Main content area */
        #app-container {
            min-height: calc(100vh - 10rem); /* Ensure footer stays at bottom on short content */
        }
       /* Styling for rendered Markdown content */
        .markdown-content h1,
        .markdown-content h2,
        .markdown-content h3 {
            @apply font-bold text-gray-100 border-b-2 border-gray-700 pb-2 mb-4;
        }
        .markdown-content h1 { @apply text-3xl mt-6; }
        .markdown-content h2 { @apply text-2xl mt-5; }
        .markdown-content h3 { @apply text-xl mt-4; }

        .markdown-content p { @apply mb-4 leading-relaxed text-gray-300; }

        .markdown-content ul,
        .markdown-content ol { @apply list-inside ml-4 mb-4; }
        .markdown-content ul { @apply list-disc; }
        .markdown-content ol { @apply list-decimal; }

        .markdown-content li { @apply mb-2; }

        .markdown-content a {
            @apply text-blue-400 font-medium;
            transition: color 0.2s ease-in-out;
        }
        .markdown-content a:hover {
            @apply text-blue-300 underline;
        }

        .markdown-content blockquote {
            @apply border-l-4 border-blue-400 bg-gray-800 p-4 italic text-gray-400 my-4 rounded-r-lg;
        }

        .markdown-content img { @apply max-w-full h-auto rounded-md my-4 shadow-lg; }

        .markdown-content table { @apply w-full border-collapse mb-4; }
        .markdown-content th, .markdown-content td {
            @apply border border-gray-700 px-4 py-2 text-left;
        }
        .markdown-content th {
            @apply bg-gray-700 font-semibold text-gray-100;
        }
        .markdown-content tr:nth-child(even) {
            @apply bg-gray-800;
        }

        /* Specific styling for inline code */
        .markdown-content code {
            @apply bg-gray-700 text-purple-300 px-2 py-1 rounded-md text-sm;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
        }

        /* Specific styling for code blocks (preformatted text) */
        .markdown-content pre {
            @apply p-4 rounded-lg overflow-x-auto mb-4 border border-gray-700 shadow-inner;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-all;
            position: relative; /* Required for positioning the copy button */
            background-color: #2d3748; /* Updated background color (gray-800) */
        }
        .markdown-content pre code {
            @apply block p-0; /* Remove background and specific color */
            font-size: 0.9rem;
        }
        /* Styling for the copy button */
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #4a5568; /* gray-600 */
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s;
            opacity: 0.7;
        }
        .copy-btn:hover {
            background-color: #2d3748; /* gray-800 */
            opacity: 1;
        }
        .copy-btn.copied {
            background-color: #38a169; /* green-600 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex flex-col min-h-screen">
    <div id="app-container" class="container mx-auto px-4 py-8 flex-grow">
        <header class="text-center mb-12">
            <h1 class="text-5xl font-extrabold text-blue-400 mb-4 rounded-lg bg-gray-800 p-4 shadow-md">
                <i class="fab fa-github text-gray-400"></i> <span id="header-title"></span>
            </h1>
            <p class="text-xl text-gray-400" id="header-subtitle"></p>
        </header>

        <main id="content-area" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="col-span-full text-center text-gray-400 text-lg">
                <p id="loading-projects-text"></p>
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-100 mx-auto mt-4" role="status" aria-label="Loading spinner"></div>
            </div>
        </main>
    </div>

    <footer class="text-center py-6 bg-gray-800 text-gray-400 mt-auto rounded-t-lg shadow-inner">
        <p id="footer-text"></p>
        <p class="text-sm" id="footer-built-with-text"></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Set dynamic text from config
            document.getElementById('page-title').textContent = config.pageTitle;
            document.getElementById('header-title').textContent = `${config.githubUsername.toUpperCase()}'s ${config.headerTitle}`;
            document.getElementById('header-subtitle').textContent = config.headerSubtitle;
            document.getElementById('footer-text').textContent = `Â© ${new Date().getFullYear()} ${config.githubUsername}. ${config.footerText}`;
            document.getElementById('footer-built-with-text').textContent = config.footerBuiltWithText;
            document.getElementById('loading-projects-text').textContent = config.loadingProjectsText;


            const githubUsername = config.githubUsername;
            const apiUrl = `https://api.github.com/users/${githubUsername}/repos?per_page=100`;
            const contentArea = document.getElementById('content-area');

            let allRepositories = [];

            // --- NEW: Function to add "Copy" buttons to code blocks ---
            function addCopyButtons() {
                const codeBlocks = document.querySelectorAll('.markdown-content pre');
                codeBlocks.forEach(block => {
                    const code = block.querySelector('code');
                    if (code) {
                        const btn = document.createElement('button');
                        btn.textContent = 'Copy';
                        btn.className = 'copy-btn';
                        btn.addEventListener('click', () => {
                            navigator.clipboard.writeText(code.innerText).then(() => {
                                btn.textContent = 'Copied!';
                                btn.classList.add('copied');
                                setTimeout(() => {
                                    btn.textContent = 'Copy';
                                    btn.classList.remove('copied');
                                }, 2000);
                            });
                        });
                        block.appendChild(btn);
                    }
                });
            }

            async function fetchRepositories() {
                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) {
                        throw new Error(`GitHub API error: ${response.statusText}`);
                    }
                    allRepositories = await response.json();
                    allRepositories.sort((a, b) => new Date(b.pushed_at) - new Date(a.pushed_at));
                    displayProjectList(allRepositories);
                } catch (error) {
                    console.error("Failed to fetch repositories:", error);
                    contentArea.innerHTML = `
                        <div class="col-span-full text-center text-red-400 text-xl p-8 bg-gray-800 rounded-lg shadow-md">
                            <p class="font-bold">${config.errorLoadingProjectsTitle}</p>
                            <p>${error.message}</p>
                            <p class="text-gray-400 text-base mt-2">${config.errorLoadingProjectsMessage}</p>
                        </div>
                    `;
                }
            }

            function displayProjectList(repos) {
                contentArea.innerHTML = '';

                if (repos.length === 0) {
                    contentArea.innerHTML = `
                        <div class="col-span-full text-center text-gray-400 text-xl p-8 bg-gray-800 rounded-lg shadow-md">
                            <p>${config.noPublicReposFound} ${githubUsername}.</p>
                            <p class="text-lg mt-2">${config.noPublicReposFoundHint}</p>
                        </div>
                    `;
                    return;
                }

                repos.forEach(repo => {
                    const description = repo.description || 'No description provided.';
                    const lastUpdated = new Date(repo.pushed_at).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    const card = document.createElement('div');
                    card.className = 'project-card bg-gray-800 rounded-lg shadow-lg p-6 flex flex-col justify-between items-start';
                    card.innerHTML = `
                        <div>
                            <h2 class="text-2xl font-bold text-gray-100 mb-3">${repo.name}</h2>
                            <p class="text-gray-300 text-base mb-4 flex-grow">${description}</p>
                            <p class="text-sm text-gray-400">Last Updated: ${lastUpdated}</p>
                        </div>
                        <button class="view-details-btn btn-primary mt-4 cursor-pointer" data-repo-name="${repo.name}">
                            ${config.viewProjectDetailsButtonText}
                        </button>
                    `;
                    contentArea.appendChild(card);
                });

                document.querySelectorAll('.view-details-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const repoName = event.target.closest('.project-card').querySelector('h2').textContent;
                        const selectedRepo = allRepositories.find(repo => repo.name === repoName);
                        if (selectedRepo) {
                            displayProjectDetails(selectedRepo);
                        }
                    });
                });
            }

            async function displayProjectDetails(repo) {
                const description = repo.description || 'No description provided.';
                const lastUpdated = new Date(repo.pushed_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                contentArea.innerHTML = `
                    <div class="col-span-full bg-gray-800 rounded-lg shadow-lg p-8 relative pt-20">
                        <div class="absolute top-4 left-4">
                            <button id="home-button" class="btn-primary inline-flex items-center">
                                <i class="fas fa-home mr-2"></i> Home
                            </button>
                        </div>
                        <header class="text-center mb-8">
                            <h1 class="text-4xl font-extrabold text-blue-400 mb-4 rounded-lg bg-gray-700 p-4 shadow-sm">
                                ${repo.name}
                            </h1>
                            <p class="text-lg text-gray-400">${description}</p>
                            <p class="text-sm text-gray-500 mt-2">Last Updated: ${lastUpdated}</p>
                        </header>
                        <section class="bg-gray-700 rounded-lg shadow-inner p-8 mb-8">
                            <h2 class="text-2xl font-bold text-gray-100 mb-4">${config.repositoryLinkTitle}</h2>
                            <a href="${repo.html_url}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center btn-secondary">
                                <i class="fab fa-github mr-3 text-xl"></i>
                                ${config.goToGithubRepoButtonText}
                            </a>
                            <p class="text-gray-400 mt-4 text-sm">${config.projectHostedOnGithubText}</p>
                        </section>
                        <section class="bg-gray-700 rounded-lg shadow-inner p-8">
                            <h2 class="text-2xl font-bold text-gray-100 mb-4">${config.projectOverviewTitle}</h2>
                            <div id="project-overview-content" class="markdown-content text-gray-300 prose prose-invert max-w-none">
                                <p>${config.loadingReadmeText}</p>
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-100 mx-auto mt-4" role="status" aria-label="${config.loadingProjectsSpinnerAltText}"></div>
                            </div>
                        </section>
                        <div class="text-center mt-8">
                            <button id="back-to-list-btn" class="btn-primary inline-flex items-center">
                                <i class="fas fa-arrow-left mr-2"></i> ${config.backToAllProjectsButtonText}
                            </button>
                        </div>
                    </div>
                `;

                document.getElementById('home-button').addEventListener('click', () => displayProjectList(allRepositories));
                document.getElementById('back-to-list-btn').addEventListener('click', () => displayProjectList(allRepositories));

                const projectOverviewContent = document.getElementById('project-overview-content');

                if (repo.renderedReadme) {
                    projectOverviewContent.innerHTML = repo.renderedReadme;
                    hljs.highlightAll();
                    addCopyButtons(); // --- MODIFIED: Call the function to add copy buttons ---
                    return;
                }

                try {
                    const readmeUrl = `https://api.github.com/repos/${githubUsername}/${repo.name}/contents/README.md`;
                    const readmeResponse = await fetch(readmeUrl);

                    if (!readmeResponse.ok) {
                        if (readmeResponse.status === 404) {
                            let placeholderListHtml = config.projectOverviewPlaceholderListItems.map(item => `<li>${item}</li>`).join('');
                            projectOverviewContent.innerHTML = `
                                <p class="text-gray-400">${config.noReadmeFoundText}</p>
                                <p class="text-gray-500 text-sm mt-2">${config.noReadmeFoundHint}</p>
                                <p class="text-gray-300 mt-4">${config.projectOverviewPlaceholderText1}</p>
                                <p class="text-gray-300">${config.projectOverviewPlaceholderText2}</p>
                                <ul class="list-disc list-inside text-gray-300 ml-4 mt-2">
                                    ${placeholderListHtml}
                                </ul>
                            `;
                        } else {
                            throw new Error(`Failed to fetch README: ${readmeResponse.statusText}`);
                        }
                        return;
                    }

                    const readmeData = await readmeResponse.json();
                    
                    // **THE FIX FOR CHARACTER ENCODING**
                    // Decode Base64 content correctly to handle UTF-8 characters like emojis
                    const binaryString = atob(readmeData.content);
                    const bytes = new Uint8Array(binaryString.length);
                    for (let i = 0; i < binaryString.length; i++) {
                        bytes[i] = binaryString.charCodeAt(i);
                    }
                    const decodedContent = new TextDecoder('utf-8').decode(bytes);

                    const renderedHtml = marked.parse(decodedContent);
                    repo.renderedReadme = renderedHtml;
                    projectOverviewContent.innerHTML = renderedHtml;
                    hljs.highlightAll();
                    addCopyButtons(); // --- MODIFIED: Call the function to add copy buttons ---

                } catch (error) {
                    console.error("Error fetching or rendering README:", error);
                    projectOverviewContent.innerHTML = `
                        <p class="text-red-400 font-bold">${config.errorLoadingReadmeTitle}</p>
                        <p class="text-gray-400 text-sm">${error.message}</p>
                    `;
                }
            }

            fetchRepositories();
        });
    </script>
</body>
</html>
